---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import { authors, getAuthorBySlug } from '@/data/authors';
import { siteConfig } from '@/config';

export async function getStaticPaths() {
  return authors.map((author) => ({ params: { slug: author.slug } }));
}

const { slug } = Astro.params as { slug: string };
const author = getAuthorBySlug(slug);
if (!author) {
  throw new Error(`Author not found: ${slug}`);
}

const authorUrl = new URL(`/authors/${author.slug}/`, siteConfig.url).href;
const description = `${author.name} is ${author.role} for ${siteConfig.name}, focused on IPTV app testing, device performance, and troubleshooting.`;
const personSchema = {
  name: author.name,
  description: author.bio,
  url: authorUrl,
  jobTitle: author.role,
  sameAs: author.sameAs,
  worksFor: {
    '@type': 'Organization',
    name: siteConfig.name,
    url: siteConfig.url,
  },
};
---

<MarketingLayout title={`${author.name} - ${siteConfig.name}`} description={description} person={personSchema}>
  <section class="py-section">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
      <header class="mb-10">
        <p class="text-sm uppercase tracking-[0.2em] text-text-muted">Author profile</p>
        <h1 class="mt-4 text-4xl font-bold text-text">{author.name}</h1>
        <p class="mt-3 text-lg text-text-muted">{author.role}</p>
        <p class="mt-2 text-sm text-text-muted">{author.location}</p>
      </header>

      <div class="rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">About</h2>
        <p class="mt-3 text-text-muted">{author.bio}</p>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Testing focus</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {author.focusAreas.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Experience and methodology</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {author.credentials.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Connect</h2>
        {author.sameAs && author.sameAs.length > 0 ? (
          <ul class="mt-3 space-y-2 text-sm text-text-muted">
            {author.sameAs.map((link) => (
              <li>
                <a class="text-primary hover:underline" href={link}>
                  {link}
                </a>
              </li>
            ))}
          </ul>
        ) : (
          <p class="mt-3 text-sm text-text-muted">
            Use the contact form for editorial corrections or testing requests.
          </p>
        )}
      </div>
    </div>
  </section>
</MarketingLayout>
