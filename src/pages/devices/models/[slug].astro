---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import { getDeviceBySlug, devices } from '@/data/devices';
import { deviceComparisons } from '@/data/device-comparisons';
import { siteConfig } from '@/config';

export async function getStaticPaths() {
  return devices.map((device) => ({ params: { slug: device.slug } }));
}

const { slug } = Astro.params as { slug: string };
const device = getDeviceBySlug(slug);
if (!device) {
  throw new Error(`Device not found: ${slug}`);
}

const relatedComparisons = deviceComparisons.filter((comparison) =>
  comparison.deviceSlugs.includes(device.slug)
);
const productSchema = {
  name: device.name,
  description: `Specs and IPTV playback notes for ${device.name}.`,
  category: 'Streaming device',
  ...(device.review
    ? {
        aggregateRating: {
          '@type': 'AggregateRating',
          ratingValue: device.review.score.overall,
          bestRating: 10,
          worstRating: 0,
          ratingCount: 1,
        },
        review: {
          '@type': 'Review',
          reviewRating: {
            '@type': 'Rating',
            ratingValue: device.review.score.overall,
            bestRating: 10,
            worstRating: 0,
          },
          author: {
            '@type': 'Person',
            name: siteConfig.author,
          },
        },
      }
    : {}),
};
---

<MarketingLayout
  title={`${device.name} - ${siteConfig.name}`}
  description={`Specs and IPTV playback notes for ${device.name}.`}
  product={productSchema}
>
  <section class="py-section">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <header class="mb-8">
        <p class="text-sm uppercase tracking-[0.2em] text-text-muted">Device profile</p>
        <h1 class="mt-3 text-4xl font-bold text-text">{device.name}</h1>
        <p class="mt-3 text-lg text-text-muted">
          Release year {device.releaseYear} · OS {device.os}
        </p>
      </header>

      <div class="rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Key IPTV-relevant specs</h2>
        <div class="mt-4 grid gap-4 sm:grid-cols-2">
          {device.specs.map((spec) => (
            <div class="rounded-md border border-border p-4 text-sm text-text-muted">
              {spec.label}: {spec.value}
            </div>
          ))}
        </div>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Playback notes</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {device.notes.map((note) => (
            <li>{note}</li>
          ))}
        </ul>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Streaming Guide test checklist</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          <li>Measured playlist load time and channel switching speed.</li>
          <li>Checked network stability on Wi-Fi and Ethernet where supported.</li>
          <li>Confirmed 4K and HDR playback based on published specs.</li>
        </ul>
      </div>

      {device.humanReview && (
        <div class="mt-8 rounded-lg border border-border p-6">
          <h2 class="text-xl font-semibold text-text">Editor review</h2>
          <p class="mt-3 text-text-muted">{device.humanReview}</p>
        </div>
      )}

      {device.editorSources && device.editorSources.length > 0 && (
        <div class="mt-8 rounded-lg border border-border p-6">
          <h2 class="text-xl font-semibold text-text">Editor sources</h2>
          <div class="mt-4 space-y-4">
            {device.editorSources.map((source) => (
              <div class="rounded-md border border-border p-4">
                <p class="text-sm text-text-muted">
                  {source.label}: <a class="text-primary hover:underline" href={source.url}>{source.url}</a>
                </p>
                <blockquote class="mt-3 text-sm text-text-muted">“{source.quote}”</blockquote>
              </div>
            ))}
          </div>
        </div>
      )}

      {device.review && (
        <div class="mt-8 rounded-lg border border-border p-6">
          <h2 class="text-xl font-semibold text-text">IPTV review summary</h2>
          <p class="mt-3 text-text-muted">{device.review.summary}</p>

          <div class="mt-6 grid gap-4 sm:grid-cols-2">
            <div class="rounded-md border border-border p-4 text-sm text-text-muted">
              Overall score: {device.review.score.overall.toFixed(1)}/10
            </div>
            <div class="rounded-md border border-border p-4 text-sm text-text-muted">
              Playback: {device.review.score.playback.toFixed(1)}/10
            </div>
            <div class="rounded-md border border-border p-4 text-sm text-text-muted">
              Network: {device.review.score.network.toFixed(1)}/10
            </div>
            <div class="rounded-md border border-border p-4 text-sm text-text-muted">
              Value: {device.review.score.value.toFixed(1)}/10
            </div>
          </div>

          <div class="mt-6 grid gap-6 md:grid-cols-2">
            <div>
              <h3 class="text-lg font-semibold text-text">Best for</h3>
              <ul class="mt-3 space-y-2 text-sm text-text-muted">
                {device.review.bestFor.map((item) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-text">Tradeoffs</h3>
              <ul class="mt-3 space-y-2 text-sm text-text-muted">
                {device.review.limitations.map((item) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          </div>

          <div class="mt-6">
            <h3 class="text-lg font-semibold text-text">IPTV performance notes</h3>
            <ul class="mt-3 space-y-2 text-sm text-text-muted">
              {device.review.iptvNotes.map((item) => (
                <li>{item}</li>
              ))}
            </ul>
          </div>
        </div>
      )}

      {relatedComparisons.length > 0 && (
        <div class="mt-8 rounded-lg border border-border p-6">
          <h2 class="text-xl font-semibold text-text">Related comparisons</h2>
          <div class="mt-4 grid gap-4 md:grid-cols-2">
            {relatedComparisons.map((comparison) => (
              <a
                class="rounded-md border border-border p-4 hover:border-primary transition-colors"
                href={`/devices/compare/${comparison.slug}/`}
              >
                <p class="font-semibold text-text">{comparison.title}</p>
                <p class="text-sm text-text-muted">{comparison.description}</p>
              </a>
            ))}
          </div>
        </div>
      )}

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Sources</h2>
        <ul class="mt-2 space-y-2 text-sm text-text-muted">
          {device.sources.map((source) => (
            <li>
              {source.label}: <a class="text-primary hover:underline" href={source.url}>{source.url}</a>
            </li>
          ))}
        </ul>
      </div>

      <div class="mt-8">
        <a class="text-primary hover:underline" href="/devices/models/">Back to device list</a>
      </div>
    </div>
  </section>
</MarketingLayout>
