---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import { platforms, topics } from '@/data/troubleshooting-platforms';
import { siteConfig } from '@/config';

export async function getStaticPaths() {
  const paths = [];
  for (const platform of platforms) {
    for (const topic of topics) {
      paths.push({ params: { platform: platform.slug, topic: topic.slug } });
    }
  }
  return paths;
}

const { platform: platformSlug, topic: topicSlug } = Astro.params as {
  platform: string;
  topic: string;
};

const platform = platforms.find((entry) => entry.slug === platformSlug);
const topic = topics.find((entry) => entry.slug === topicSlug);

if (!platform || !topic) {
  throw new Error(`Troubleshooting page not found: ${platformSlug}/${topicSlug}`);
}

const pageTitle = `${platform.name} IPTV ${topic.title}`;
const description = `${topic.title} fixes for ${platform.name} (${platform.os}).`;
---

<MarketingLayout title={`${pageTitle} - ${siteConfig.name}`} description={description} faq={topic.faq}>
  <section class="py-section">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <header class="mb-8">
        <p class="text-sm uppercase tracking-[0.2em] text-text-muted">{platform.os} troubleshooting</p>
        <h1 class="mt-3 text-4xl font-bold text-text">{platform.name}: {topic.title}</h1>
        <p class="mt-4 text-lg text-text-muted">
          Targeted fixes for {topic.title.toLowerCase()} on {platform.name}. These steps focus on
          {platform.os} settings, playlist behavior, and network stability.
        </p>
      </header>

      <div class="rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Common symptoms</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {topic.symptoms.map((symptom) => (
            <li>{symptom}</li>
          ))}
        </ul>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Quick fixes</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {topic.quickFixes.map((fix) => (
            <li>{fix}</li>
          ))}
        </ul>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Platform-specific checks</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {platform.appTips.map((tip) => (
            <li>{tip}</li>
          ))}
        </ul>
        <p class="mt-4 text-sm text-text-muted">Settings path: {platform.settingsPath}</p>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Deep diagnostics</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {topic.deepChecks.map((check) => (
            <li>{check}</li>
          ))}
        </ul>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Network-specific tips</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {platform.networkTips.map((tip) => (
            <li>{tip}</li>
          ))}
        </ul>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Provider checks</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {topic.providerChecks.map((check) => (
            <li>{check}</li>
          ))}
        </ul>
      </div>

      <div class="mt-8">
        <a class="text-primary hover:underline" href={`/troubleshooting/platforms/${platform.slug}/`}>
          Back to {platform.name} troubleshooting
        </a>
      </div>

      <div class="mt-8 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Related resources</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          <li><a class="text-primary hover:underline" href="/learn/">IPTV learning center</a></li>
          <li><a class="text-primary hover:underline" href="/comparisons/">Compare apps and devices</a></li>
          <li><a class="text-primary hover:underline" href="/guides/">Setup guides</a></li>
        </ul>
      </div>
    </div>
  </section>
</MarketingLayout>
