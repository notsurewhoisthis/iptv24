---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import { platforms, topics } from '@/data/troubleshooting-platforms';
import { siteConfig } from '@/config';

export async function getStaticPaths() {
  return platforms.map((platform) => ({ params: { platform: platform.slug } }));
}

const { platform: platformSlug } = Astro.params as { platform: string };
const platform = platforms.find((entry) => entry.slug === platformSlug);
if (!platform) {
  throw new Error(`Platform not found: ${platformSlug}`);
}
---

<MarketingLayout
  title={`${platform.name} IPTV Troubleshooting - ${siteConfig.name}`}
  description={`Fix IPTV issues on ${platform.name} with ${platform.os}-specific steps.`}
>
  <section class="py-section">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
      <header class="mb-10">
        <p class="text-sm uppercase tracking-[0.2em] text-text-muted">{platform.os}</p>
        <h1 class="mt-3 text-4xl font-bold text-text">{platform.name} troubleshooting</h1>
        <p class="mt-4 text-lg text-text-muted">
          Use the topics below to diagnose IPTV issues on {platform.name}. Each guide is tailored to
          {platform.os} settings and {platform.store} app behavior.
        </p>
      </header>

      <div class="rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Device notes</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          {platform.notes.map((note) => (
            <li>{note}</li>
          ))}
        </ul>
        <p class="mt-4 text-sm text-text-muted">Settings path: {platform.settingsPath}</p>
      </div>

      <div class="mt-8 grid gap-6 md:grid-cols-2">
        {topics.map((topic) => (
          <a
            class="rounded-lg border border-border p-6 hover:border-primary transition-colors"
            href={`/troubleshooting/platforms/${platform.slug}/${topic.slug}/`}
          >
            <h2 class="text-xl font-semibold text-text">{topic.title}</h2>
            <p class="mt-2 text-sm text-text-muted">{topic.symptoms.join('; ')}</p>
          </a>
        ))}
      </div>

      <div class="mt-10 rounded-lg border border-border p-6">
        <h2 class="text-xl font-semibold text-text">Related resources</h2>
        <ul class="mt-3 space-y-2 text-sm text-text-muted">
          <li><a class="text-primary hover:underline" href="/learn/">IPTV learning center</a></li>
          <li><a class="text-primary hover:underline" href="/comparisons/">Compare apps and devices</a></li>
          <li><a class="text-primary hover:underline" href="/guides/">Setup guides</a></li>
        </ul>
      </div>
    </div>
  </section>
</MarketingLayout>
